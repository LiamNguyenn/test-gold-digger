version: 2

models:
    - name: customers_accounts
      schema: customers
      alias: accounts
      config:
        grants:
          select: ['vitally']
      columns:
        - name: external_id   
          tests:            
            - not_null
            - unique:
                config:
                  severity: error
                  error_if: ">100"
                  warn_if: ">10"
        - name: billing_contact_email
          meta:
            sensitive: true
            masking_rules:
              full_mask:
                mask_function: sha2-256
        - name: primary_contact_email
          meta:
            sensitive: true
            masking_rules:
              full_mask:
                mask_function: sha2-256
    - name: customers_users
      schema: customers
      alias: users
      config:
        grants:
          select: ['vitally']
      columns:
        - name: user_uuid
          tests:            
            - not_null
        - name: "(user_uuid || account_list )"
          tests:            
            - unique
        - name: account_email
          meta:
            sensitive: true
            masking_rules:
              full_mask:
                mask_function: sha2-256
        - name: email
          meta:
            sensitive: true
            masking_rules:
              full_mask:
                mask_function: sha2-256
    
    - name: customers_int_events
      schema: customers
      alias: int_events
      columns:
        - name: user_id   
        - name: organisation_id   
        - name: kp_employee_id   
        - name: kp_business_id   
        - name: email
          meta:
            sensitive: true
            masking_rules:
              full_mask:
                mask_function: sha2-256
        - name: user_email
          meta:
            sensitive: true
            masking_rules:
              full_mask:
                mask_function: sha2-256
    - name: customers_events
      schema: customers
      alias: events
      config:
        grants:
          select: ['vitally', 'sisense'] 

    - name: customers_zuora_account_product
      schema: customers
      alias: zuora_account_product
      columns:
        - name: zuora_account_id   
          tests:            
            - not_null
            - unique

    - name: customers_mdaumau
      schema: customers
      alias: mdaumau
      columns:
        - name: date  
          tests:            
            - not_null
            - unique 
    - name: nps
      schema: customers
      columns:
        - name: email
          meta:
            sensitive: true
            masking_rules:
              full_mask:
#    - name: users_vw
#      schema: customers
#      columns:
#        - name: address
#          meta:
#            sensitive: true
#            masking_rules:
#              full_mask:
#                mask_function: sha2-256
