version: 2
models:
  - name: fct_instapay_transactions
    description: This is the fact table for instapay transactions, sourced from stg_instapay_db.instapay_transactions table. The grain of this table is at the transaction level
    meta: 
      upstream_system_owner: "squad-squid"
      data_owner: "gold-diggers"
    columns:
      - name: id
        description: The unique ID for the transaction
      - name: dim_employee_uuid
        description: The ID of the employee undertaking the transaction
      - name: transaction_date
        description: The date of the Instapay transaction
      - name: transaction_status
        description: The status of the transaction; this field has values that are either sourced from the ABA files (e.g. pending, payment_processed, complete) or from Shaype (e.g. shaype_processing, shaype_accepted)
      - name: fee_tier
        description: The fee tier of the transaction; possible values for this field are default, free_trial, or custom_fee. Unknown is used as a catch all to ensure that all rows have values
      - name: transaction_amount
        description: The amount of the transaction
      - name: revenue_amount
        description: The revenue amount earned on the Instapay Transaction; currently this is only based on the admin fee charged per transaction
      - name: dim_date_sk
        description: The generated surrogate key for the transaction date, to be joined with dim_date
  - name: fct_herodollar_transactions
    description: This is the fact table for hero dollar / hero points transactions, sourced from stg_herodollar_db.hero_dollar_transactions table. The grain of this table is at the transaction level
    meta: 
      upstream_system_owner: "squad-sunny"
      data_owner: "gold-diggers"
    columns:
      - name: id
        description: The unique transaction ID
      - name: dim_date_sk
        description: The generated surrogate key for the transaction date, to be joined with dim_date
      - name: dim_user_eh_user_id
        description: The EH platform user ID for the transaction; null if the transaction_initiator_type is organisation
      - name: dim_organisation_id
        description: The organisation ID of the transaction; null if the transaction_initiator_type is user
      - name: ref_id
        description: The reference ID of the transaction; this is used to link to various other sources (e.g. heroshop transactions, herodollar purchase etc.)
      - name: parent_id
        description: The parent ID of the transaction
      - name: transaction_source
        description: The source of the transaction (known as client type in the source system); example values are ebf_shaype, marketplace, hero_dollar_purchase, etc.
      - name: transaction_initiator_type
        description: The type of the transaction initiator; possible values are organisations and users (known as transactable type in the source system)
      - name: transaction_type
        description: The type of the transaction; possible values are top_up, withdrawal, topup_reversion, withdrawal_reversion, deduction and deduction_reversion
      - name: reason_type
        description: The reason / purpose for the transaction; possible values are marketing, assisted_implementation, staff_rewards, commission etc.
      - name: currency_code
        description: The currency code of the transaction
      - name: is_hero_points_transaction
        description: A boolean flag to indicate whether the transaction is a transaction using hero points
      - name: hero_dollar_amount
        description: The amount of hero dollars used in the transaction
      - name: hero_points_amount
        description: The amount of hero points used in the transaction
      - name: hero_points_conversion_rate
        description: The conversion rate of hero points to hero dollars
      - name: unified_transaction_amount
        description: The unified transaction amount; hero points transactions are converted to their dollar value
      - name: transaction_date
        description: The date of the transaction
      - name: revenue_amount
        description: The revenue amount of the transaction
  - name: fct_bill_management_transactions
    description: This is the fact table for bill payments transactions, sourced from stg_ebenefits__bill_paid table. The grain of this table is at the bill payment transaction level
    meta: 
      upstream_system_owner: "squad-hustle"
      data_owner: "gold-diggers"
    columns:
      - name: dim_bill_id
        description: The bill ID associated to the payments, to be joined with dim_bill table
      - name: dim_bill_management_subscription_id
        description: The subscription ID associated to the bill, to be joined with dim_bill_management_subscription table
      - name: dim_bill_management_provider_sk
        decription: The surrogate key generated based on the provider ID associated to the bill, to be joined with dim_bill_management_provider table
      - name: dim_date_sk
        description: The generated surrogate key for the transaction date, to be joined with dim_date
      - name: currency
        description: The currency of the transaction
      - name: bill_amount
        description: The amount charged by the provider in the bill
      - name: paid_amount
        description: The amount paid by the user for the bill
      - name: revenue_amount
        description: The revenue amount earned by Employment Hero from the transaction; currently calculated as 1% of the paid bill amount
  - name: fct_cashback_transactions
    description: This is the fact table for cashback transactions, sourced from stg_ebenefits__cashback_transactions table. The grain of this table is at the transaction level
    meta: 
      upstream_system_owner: "squad-hustle"
      data_owner: "gold-diggers"
    columns:
      - name: transaction_timestamp
        description: The timestamp of the transaction
      - name: processed_timestamp
        description: The timestamp of when the transaction was processed
      - name: dim_date_sk
        description: The generated surrogate key for the transaction timestamp, to be joined with dim_date
      - name: merchant_name
        description: The name of the merchant where the transaction was made
      - name: dim_user_ebenefits_user_uuid
        description: The ebenefits user uuid of the user who made the transaction; extracted from the hashed user email supplied by our partner (Pokitpal)
      - name: transaction_amount
        description: The amount of the cashback transaction
      - name: revenue_amount
        description: The revenue amount earned by Employment Hero from the transaction
      - name: cashback_amount
        description: The cashback amount earned by the user from the transaction
  - name: fct_heroshop_order_details
    description: This is the fact table for heroshop order details, sourced from stg_heroshop_db_public__order_details table. The grain of this table is at the order details level
    meta: 
      upstream_system_owner: "squad-hustle"
      data_owner: "gold-diggers"
    columns:
      - name: id
        description: The id of the heroshop order detail
      - name: order_date
        description: Date of the heroshop order
      - name: dim_date_sk
        description: Order date joined with dim_date
      - name: order_id
        description: The id of parent order
      - name: dim_heroshop_product_variant_id
        description: The id of the product variant, to be joined with dim_heroshop_product_variant
      - name: dim_employee_eh_employee_id
        description: The id of the employee, to be joined with dim_employee
      - name: dim_heroshop_product_id
        description: The id of the product, to be joined with dim_heroshop_product
      - name: dim_product_category_product_category_id
        description: The id of the product category, to be joined with dim_product_category
      - name: dim_supplier_id
        description: The id of the supplier, to be joined with dim_supplier
      - name: local_id
        description: User friendly ID of the order detail
      - name: discount
        description: Discount on the order detail
      - name: quantity
        description: Quantity of the order detail
      - name: subtotal
        description: Subtotal of the order detail
      - name: billable_amount
        description: Billable amount of the order detail
      - name: price
        description: Price of the order detail
      - name: transaction_fee
        description: Transaction fee for the order detail
      - name: supplier_price
        description: Supplier price of the order detail
      - name: freight_cost
        description: Freight Cost of the order detail
      - name: total_price
        description: Product of price and quantity of the order detail
      - name: supplier_cost
        description: Derived from int_map_heroshop_supplier_cost at product variant level
      - name: savings
        description: Discount less transaction fee
      - name: margin
        description: Billable amount less transaction fee less freight cost less total supplier cost
      - name: status
        description: Status of the order detail

  - name: fct_heroshop_transactions
    description: This is the fact table for heroshop transactions, sourced from stg_heroshop_db_public__transactions table. The grain of this table is at the transactions level
    meta: 
      upstream_system_owner: "squad-hustle"
      data_owner: "gold-diggers"
    columns:
      - name: id
        description: The id of the heroshop transaction
      - name: order_id
        description: The order_id associated with the heroshop transaction, mappable with order_id from fct_heroshop_order_details
      - name: status
        description: Status of the heroshop transaction
      - name: transaction_date
        description: Date of the heroshop transaction
      - name: dim_date_sk
        description: Date of the heroshop transaction, joined with dim_date
      - name: payment_method
        description: Obtained from int_map_heroshop_payment_method, unique values are credit_card, instapay, hero_dollars, hero_points and/or unknown.
      - name: transaction_amount
        description: Money used in the transaction
      - name: hero_points_amount
        description: Hero points used in the transaction
      - name: transaction_fee
        description: Transaction fee associated with the heroshop transaction
      - name: fee_rate
        description: Fee rate for the heroshop transaction
      - name: currency_code
        description: Currency used in the heroshop transaction
  - name: dim_heroshop_product_variant
    description: This is the dim table for heroshop product variants, sourced from stg_heroshop_db_public__product_variants table. The grain of this table is at the product variant level
    meta: 
      upstream_system_owner: "squad-hustle"
      data_owner: "gold-diggers"
    columns:
      - name: dim_heroshop_product_variant_id
        description: The id of the heroshop product variant, primary key for this table
      - name: variant_code
        description: Variant code of the heroshop product variant
      - name: price
        description: Price of the heroshop product variant
      - name: discounted_price
        description: Discounted price of the heroshop product variant
      - name: rrp
        description: RRP (Recommended Retail Price) of the heroshop product variant
      - name: supplier_price
        description: Supplier price of the heroshop product variant
      - name: freight_price
        description: Freight price of the heroshop product variant
  - name: dim_heroshop_product
    description: This is the dim table for heroshop products, sourced from stg_heroshop_db_public__products table. The grain of this table is at the product level
    meta: 
      upstream_system_owner: "squad-hustle"
      data_owner: "gold-diggers"
    columns:
      - name: dim_heroshop_product_id
        description: The id of the heroshop product variant, primary key for this table
      - name: product_name
        description: Name of the product
      - name: product_code
        description: Product code
      - name: product_country
        description: Product Country
      - name: product_type_enum
        description: Enum of the product type
      - name: product_type
        description: Value of the product type, derived from https://github.com/Thinkei/marketplace-service/blob/43a1791fb3959a46e1bf154c130b7982eb1f28d1/app/models/product.rb