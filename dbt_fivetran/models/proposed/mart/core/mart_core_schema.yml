version: 2

models:
  - name: dim_date
    description: Date dimension table to be joined to fact tables for analysis
    columns: 
      - name: report_date
        description: The date field to be joined to other fact tables and displayed as the anchor date
      - name: calendar_year
        description: The calendar year of the report date
      - name: calendar_year_half
        description: The calendar year half of the report date
      - name: calendar_quarter
        description: The calendar quarter of the report date
      - name: calendar_month
        description: The calendar month of the report date
      - name: calendar_week
        description: The calendar week of the report date
      - name: calendar_day
        description: The calendar day of the report date
      - name: month_name
        description: The name of the month of the report date
      - name: day_name
        description: The name of the day of the report date
      - name: financial_year
        description: The financial year of the report date
      - name: financial_year_half
        description: The financial year half of the report date
      - name: financial_quarter
        description: The financial quarter of the report date
      - name: financial_month
        description: The financial month of the report date
      - name: dim_date_sk
        description: The generated date ID for the report date, to be joined with fact tables
  - name: dim_user
    description: |
      This is the main dim table listing **all** users in the Employment Hero (EH) HR, Keypay payroll platform and eBenefits platform.

      We've decided to incorporate ebenefits user as a separate row as one EH / Keypay user might have multiple ebenefits user profile. 

      Where the users come from the eBenefits platform, their details (e.g. first name, last name etc) are sourced from either the underlying Keypay / EH HR platform.

      Users listed in this table include all user personas (candidates, employees, and terminated_employees)  

      Filters applied to this model:  
      - Users deleted from the postgres_public.users table are excluded
      - Users records marked as shadow data are excluded

    meta: 
      upstream_system_owner: "squad-platform, keypay, ebf-platform"
      data_owner: "gold-diggers"
    columns:
      - name: platform
        description: |
          The platform where the user record originated from. Possible values are:
          - "`employment_hero`"
          - "`keypay`"
          - "`ebenefits`"
      - name: dim_user_eh_user_id
        description: The user ID generated by the EH platform
      - name: dim_user_eh_user_uuid
        description: The user UUID generated by the EH platform
      - name: dim_user_keypay_user_id
        description: The user ID generated by the Keypay platform
      - name: dim_user_ebenefits_user_uuid
        description: The user UUID generated by the ebenefits platform
      - name: dim_user_sk
        description: The generated surrogate key for the user record, created from the platform field, EH user ID field and the Keypay user ID field
        tests:
          - unique:
              config:
                severity: warn
          - not_null:
              config:
                severity: warn
      - name: first_name
        description: The first name of the user
      - name: last_name
        description: The last name of the user
      - name: email
        description: The email address of the user
        meta:
          sensitive: true
          masking_rules:
            full_mask:
              mask_function: sha2-256
      - name: has_acknowledged_eh_tnc
        description: A boolean flag to indicate whether the user has acknowledged the EH platform's terms and conditions
      - name: is_twofa_enabled
        description: A boolean flag to indicate whether the user has enabled two-factor authentication
      - name: is_verified
        description: A boolean flag to indicate whether the user's profile has been successfully verified
      - name: is_profile_completed
        description: A boolean flag to indicate whether the user has completed their profile
      - name: is_public_profile
        description: A boolean flag to indicate whether the user has set their profile to be searchable publicly
      - name: is_active
        description: A boolean flag to indicate whether the user's profile is active; this is currently simply assumed to be true as long as the profile has been activated once
      - name: is_current_eh_employee
        description: A boolean flag to indicate whether the user is currently an internal EH employee
      - name: active_employee_count
        description: The number of active employee records associated with the user in either EH or Keypay platform
      - name: terminated_employee_count
        description: The number of terminated employee records associated with the user in either EH or Keypay platform
      - name: current_persona
        description: |
          The current persona of the user. Possible values are employee or candidate

          The user is considered an employee if they are associated with **at least** 1 active employee record
          The user is considered a candidate if they are **not** associated with any active employee record
      - name: is_payroll_admin
        description: A boolean flag to indicate whether the user is a payroll admin in the Keypay payroll platform
      - name: is_marketing_consented
        description: A boolean flag to indicate whether the user has consented to marketing communications
      - name: marketing_consented_at
        description: The timestamp of when the user consented to marketing communications
      - name: created_at
        description: The timestamp of when the user's profile was created
  