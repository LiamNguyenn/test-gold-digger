version: 2
models:
  - name: int_checkly_results
    description: "This table enriches the checkly.all_checks_results table to add check type and also calculate the timestamp of when the next check was started for the component. It only contains the results for checks that are activated. It excludes the check for components that are for staging environment, testing or a copy of existing component"
    schema: intermediate
    materialized: view
    meta: 
      logic_owner: ""
      data_owner: "gold-diggers"
    columns:
      - name: id
        description: Unique id from checkly.all_checks_results.
      - name: check_type
        description: Whether the check was done for Browser or API
      - name: current_check_started_at
        description: The timestamp at which the check started
      - name: current_check_stopped_at
        description: The timestamp at which the check stopped
      - name: name
        description: Name of the component (event) for which the check was done
      - name: has_failures
        description: True if the check detected that the component had failures
      - name: has_errors
        description: If the check resulted in any errors
      - name: is_degraded
        description: ""
      - name: over_max_response_time
        description: ""
      - name: next_check_started_at
        description: For the given component, the timestamp at which when the next check started

  - name: int_checkly_downtime_global_raw
    description: "This table is built on top of int_checkly_results and contains most of the logic needed for computing downtime. All the fields in the table have been calculated separately for overall platform, Quickbooks Australia and Quickbooks UK"
    schema: intermediate
    materialized: view
    meta: 
      logic_owner: ""
      data_owner: "gold-diggers"
    columns:
      - name: id
        description: Unique id from checkly.all_checks_results
      - name: name
        description: Name of the component
      - name: check_type
        description: Whether the check was done for Browser or API
      - name: current_check_started_at
        description: The timestamp at which the check started
      - name: current_check_stopped_at
        description: The timestamp at which the check stopped
      - name: next_check_started_at
        description: The timestamp at which the next check started for the given component
      - name: downtime_check_start_date
        description: Time difference in seconds between the current check start timestamp and the end of day or next check start timestamp, whichever is earlier. This is to cut-off the calculation of downtime for the given day
      - name: checkpoint
        description: It is the next check start timestamp of the immediate previous check. This is used to determine if there is an overlap between the checks 
      - name: overlap_check_start_date
        description: Only calculated if the next check start timestamp < checkpoint, else 0. It is the time difference between the current check start timestamp and the earliest of checkpoint / end of day / next check start timestamp
      - name: net_downtime_check_start_date
        description: The difference in seconds between the downtime_check_start_date and overlap_check_start_date. This cannot be negative.
      - name: downtime_check_end_date
        description: Only calculated when current check start date < current check stop date, else 0. Time difference in seconds between 1 day added to current check start timestamp and current check stop timestamp. 
      - name: overlap_check_end_date
        description: Only calculated when current check start date < current check stop date and date of checkpoint = current check stop date, else 0. Calculates overlap in seconds for check stopped at    
      - name: net_downtime_check_end_date
        description:  The difference between downtime_check_end_date and overlap_check_end_date  
      - name: is_overall_downtime
        description: True if the row is calculated for the entire Payroll platform
      - name: is_qbo_au_downtime
        description: True if the row is calculated for the Payroll platform for Quickbooks Australia
      - name: is_qbo_uk_downtime
        description: True if the row is calculated for the Payroll platform for Quickbooks UK
      
  - name: int_checkly_daily_downtime
    description: ""
    schema: intermediate
    materialized: view
    meta: 
      logic_owner: ""
      data_owner: "gold-diggers"
    columns:
      - name: date
        description: date
      - name: name
        description: "Name of the payroll platform component. Eg: AU Prod Login, UK Prod Finalise a pay run"
      - name: total_net_downtime
        description: Total downtime in seconds with overlaps between components downtime accounted for. This is used in calculation for overall platform uptime
      - name: total_downtime
        description: Downtime in seconds for the given component for the day
      - name: qbo_au_net_downtime
        description: Total downtime in seconds for Quickbooks Australia with overlaps between it's components downtime accounted for. This is used in calculation for overall QBO Australia platform uptime.
      - name: qbo_au_downtime
        description: Downtime in seconds for the given Quickbooks Australia component for the day
      - name: qbo_uk_net_downtime
        description: Total downtime in seconds for Quickbooks UK with overlaps between it's components downtime accounted for. This is used in calculation for overall QBO UK platform uptime.
      - name: qbo_uk_downtime
        description: Downtime in seconds for the given Quickbooks UK component for the day